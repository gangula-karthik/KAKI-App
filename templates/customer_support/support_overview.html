{% extends "template.html" %}

{% block content %}
<div class="card w-75 mb-3 text-center text-bg-dark mx-auto d-flex outline-div">
  <div class="card-body">
    <h1 class="card-title">KAKI support üë®‚Äçüíª</h1>
    <p class="card-text">Welcome to KAKI customer support, how may we assist you today ?</p>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
      >Raise a ticket <i class="fa-solid fa-plus"></i></button>
  </div>
</div>

{% include 'customer_support/ticket_creation_modal.html' %}



<h1 class="text-center" id="FAQ">Frequently Asked Question</h1>


<div class="accordion w-75 mx-auto bg-dark" id="accordionPanelsStayOpenExample">
  {% for faq in faqs %}
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
        data-bs-target="#panelsStayOpen-collapse{{ loop.index }}" aria-expanded="false" aria-controls="panelsStayOpen-collapse{{ loop.index }}">
        {{ faq.question }}
      </button>
    </h2>
    <div id="panelsStayOpen-collapse{{ loop.index }}" class="accordion-collapse collapse">
      <div class="accordion-body">
        <strong>{{ faq.answer }}</strong>
      </div>
    </div>
  </div>
  {% endfor %}
</div>


<script>

function checkFaqStatus() {
    fetch('/faq_status')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'done') {
                // The task is done, reload the page
                location.reload();
            } else {
                // The task is not done yet, check again in 5 seconds
                setTimeout(checkFaqStatus, 5000);
            }
        });
}

// Start checking the status as soon as the page loads
checkFaqStatus();



// Check if FAQ generation is done every 5 seconds
setInterval(function() {
  fetch('/check_faq_generation')
    .then(response => response.json())
    .then(data => {
      if (data.done) {
        // FAQ generation is done, update the FAQ section
        let accordion = document.getElementById('accordionPanelsStayOpenExample');
        accordion.innerHTML = '';
        data.faqs.forEach((faq, index) => {
          accordion.innerHTML += `
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#panelsStayOpen-collapse${index}" aria-expanded="false" aria-controls="panelsStayOpen-collapse${index}">
                  ${faq.question}
                </button>
              </h2>
              <div id="panelsStayOpen-collapse${index}" class="accordion-collapse collapse">
                <div class="accordion-body">
                  <strong>${faq.answer}</strong>
                </div>
              </div>
            </div>
          `;
        });
      }
    });
}, 5000);
</script>

{% endblock %}
